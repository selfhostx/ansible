# Cleanup old Debian Bacula packages before installing from official repository
# This must run BEFORE any package installations to avoid dependency conflicts
---
- name: Cleanup | Remove all old Debian Bacula packages if using official repository
  ansible.builtin.apt:
    name:
      # Director packages
      - bacula-bscan
      - bacula-director
      - bacula-director-mysql
      - bacula-director-pgsql
      - bacula-common-mysql
      - bacula-common-pgsql
      # Storage Daemon
      - bacula-sd
      # File Daemon
      - bacula-fd
      # Console
      - bacula-console
      # Common (remove last to avoid dependency issues)
      - bacula-common
    state: absent
    purge: false
  when:
    - bacula_use_official_repo | default(false) | bool
    - ansible_facts['os_family'] == 'Debian'
  tags:
    - packages
    - bacula-cleanup
